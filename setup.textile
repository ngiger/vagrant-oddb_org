h2. requirements

* Ruby 1.9.3
* bundler installed (eg. via gem install bundler)

h2. Setup

h3. Clone the vagrant-oddb git and install the needed gems

* @git clone git://github.com/ngiger/vagrant-oddb_org.git@
* @cd vagrant-oddb@
* @bundle install@

h3. Create a basebox using veewee

* @git clone git://github.com/jedi4ever/veewee.git@
* @cd veewee@
* Assure that the reference for vagrant is active in the Gemfile (Somebody made it inactive as per 2013-04-03)
* @bundle update@
* @vagrant basebox define funtoo-oddb funtoo-latest-x86_64@
* Edit definitions/funtoo-oddb/definition.rb to match the desired numbers of CPUs and memory
* @vagrant basebox build  funtoo-oddb@ # may take an hour or more
* @vagrant basebox export funtoo-oddb@
* @vagrant box add funtoo-oddb funtoo-oddb.box@

h3. Create and edit your configuration

The configuration with all your private data and keys is YAML file name @/path/to/clone/of/vagrant-oddb_org/hieradata/private/config.yaml@. You have to create the folder. Then you create the file and place the following definitions in it.
We assume that the mail server supports SMTP with TLS.

bc. "::oddb_org::mail::smtp_host":  smtp.provider.net:port
"::oddb_org::mail::user":       user.account@provider.net
"::oddb_org::mail::password":   topsecret_password
"::oddb_org::hostname":         oddb.niklaus.org
# don't change the following name. It seems that we can only work with the vagrant default
"::oddb_org::ip":               10.0.2.15
'::oddb_org::username':         a_user
'::oddb_org::root_name':        a_user@ywesee.com
'::oddb_org::root_hash':        ec74c79bb6e82b4a0a448f6a1134d8fd4fd3c6ff40fd7ec58adee9805c757c00
 
h3. Start vagrant

* @cd /path/to/clone/of/vagrant-oddb_org@
** @vagrant up@  # will take half an hour or so


h2. installation into an already running funtoo server

These steps have not yet been verified. Ask Niklaus if it does not work! They must be run as root

bc. emerge puppet  # ensure that version 3.1 or higher is installed
emerge ruby-augeas  # this must also be installed before running puppet to avoid errors
mv /etc/puppet /etc/puppet.backup
git clone git://github.com/ngiger/vagrant-oddb_org.git /etc/puppet
gem install librarian-puppet
librarian-puppet install --clean
mkdir /etc/puppet/private
vim etc/puppet/private/config.yml # see section "Create and edit your configuration"
cd /etc/puppet
puppet apply

h2. Testing changes

If you want to test your configuration or your changes to manifests, the following might work for you

bc. cd /etc/puppet
librarian-puppet install
rm -rf /etc/yus
# shows the step needed to recreate the yus DB
puppet apply modules/oddb_org/tests/yus.pp --noop  
# verbose output
puppet apply modules/oddb_org/tests/yus.pp --verbose 
# debugging output
puppet apply modules/oddb_org/tests/yus.pp --debug 

h2. remarks

If you want to change the servername you have to edit the following file
* hieradata/private/config.yml 
and create a definition for your host, e.g. using a logical link
* @ln -s oddb.pp manifests/nodes/your_hostname.pp@
