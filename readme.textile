h2. requirements

* Ruby 1.9.3
* bundler installed (eg. via gem install bundler)

h2. Setup

h3. Clone the vagrant-oddb git and install the needed gems

* @git clone git://github.com/ngiger/vagrant-oddb_org.git@
* @cd vagrant-oddb@

h3. Create and edit your configuration

The configuration with all your private data and keys is YAML file name @/path/to/clone/of/vagrant-oddb_org/hieradata/private/config.yaml@. You have to create the folder. Then you create the file and place the following definitions in it.
We assume that the mail server supports SMTP with TLS.

bc. "::oddb_org::mail::smtp_host":  smtp.provider.net:port
"::oddb_org::mail::user":       user.account@provider.net
"::oddb_org::mail::password":   topsecret_password
"::oddb_org::hostname":         oddb.niklaus.org
"::oddb_org::ip":               198.168.50.1
'::oddb_org::username':         a_user
'::oddb_org::root_name':        a_user@ywesee.com
'::oddb_org::root_hash':        ec74c79bb6e82b4a0a448f6a1134d8fd4fd3c6ff40fd7ec58adee9805c757c00
 
h3. Download an actual dump of the database

You must have setup your acount for using @scp ywesee@thinpower.ywesee.com@

* @./get_db_dumps.rb@

h3. Start vagrant

* @cd /path/to/clone/of/vagrant-oddb_org@
* @bundle install@
* @librarian-puppet install --clean@
* @vagrant up@  # will take half an hour or so


h2. installation into an already running funtoo server

These steps have not yet been verified. Ask Niklaus if it does not work! They must be run as root

bc. emerge puppet  # ensure that version 3.1 or higher is installed
emerge ruby-augeas  # this must also be installed before running puppet to avoid errors
mv /etc/puppet /etc/puppet.backup
git clone git://github.com/ngiger/vagrant-oddb_org.git /etc/puppet
mkdir /etc/puppet/private
vim etc/puppet/private/config.yml # see section "Create and edit your configuration"
cd /etc/puppet
bundle install
librarian-puppet install --clean
puppet apply

h2. Testing changes

If you want to test your configuration or your changes to manifests, the following might work for you

bc. cd /etc/puppet
librarian-puppet install
rm -rf /etc/yus
# shows the step needed to recreate the yus DB
puppet apply modules/oddb_org/tests/yus.pp --noop  
# verbose output
puppet apply modules/oddb_org/tests/yus.pp --verbose 
# debugging output
puppet apply modules/oddb_org/tests/yus.pp --debug 

h2. remarks

If you want to change the servername you have to edit the following file
* hieradata/private/config.yml 
and create a definition for your host, e.g. using a logical link
* @ln -s oddb.pp manifests/nodes/your_hostname.pp@

h3. How the funtoo-oddb basebox was created using veewee

bc. git clone git://github.com/ngiger/veewee.github
cd veewee
bundle install
export name="funtoo-oddb-`date +%Y%m%d`"
echo creating $name based on funtoo-latest-x86_64
veewee vbox define  --force $name 'funtoo-latest-x86_64'
cp -rpv /path/to/vagrant-oddb/definitions/funtoo-oddb/* definitions/${name}/veewee vbox build --force $name 2>&1 | tee $name.log
veewee vbox export --force $name
vagrant box add $name "$name.box"
rm Vagrantfile
vagrant init
vagrant up

