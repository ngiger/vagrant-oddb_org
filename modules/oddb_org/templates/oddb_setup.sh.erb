#!/bin/bash -v
# Modified by Niklaus Giger, 2013 april first
export ODDB_HOME=<%= foostatus = scope.lookupvar('ODDB_HOME') %>
eselect ruby set ruby19
echo PATH ist $PATH
cd $ODDB_HOME
pwd
cp .git/refs/heads/master .git/ORIG_HEAD
# cp -r /home/vagrant/oddb_setup/captcha data
ruby bin/update_css

ruby -v
gem list -i racc;  if [ $? -ne 0 ] ; then gem install racc; fi
gem list racc
cd data
mkdir -p pdf
cd quanty
pwd
ruby extconf.rb
if [ $? -ne 0 ] ; then exit 1; fi
src=parse.y
dst=lib/quanty/parse.rb
tmp=lib/quanty/parse.backup
rm -f $dst
mkdir -p `dirname $dst`
# TODO: how to make this clean ??
# racc -E -o $dst $src
if [ $? -ne 0 ] ; then exit 1; fi
# mv $dst $tmp
# echo '# encoding: utf-8'  > $dst
# echo $tmp >> $dst
pwd
# make
if [ $? -ne 0 ] ; then exit 1; fi
# make install
if [ $? -ne 0 ] ; then exit 1; fi
